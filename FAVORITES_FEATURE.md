# 收藏功能说明

## 概述

本应用现在支持两类收藏功能：
1. **商品收藏** - 收藏特定商品（不关联特定店铺）
2. **店铺收藏** - 收藏特定超市/店铺

## 功能特点

### 商品收藏 (Product Favorites)
- 收藏商品名称，不绑定特定店铺
- 可以查看该商品在不同店铺的价格变化
- 显示价格范围、平均价格、在售店铺数量
- 包含价格历史曲线图
- 支持快速添加到购物车

### 店铺收藏 (Store Favorites)
- 收藏特定超市/店铺
- 显示店铺信息、位置、商品数量
- 快速访问店铺详情

### 原有收藏功能
- 收藏特定商品在特定店铺的实例
- 与购物车和价格提醒集成

## 使用方法

### 在商品网格中
- 点击商品卡片右上角的三个按钮：
  - 🔵 **Store图标** - 商品收藏（蓝色）
  - ❤️ **Heart图标** - 店铺特定收藏（红色）
  - 🛒 **Cart图标** - 加入购物车（绿色）

### 在商品详情页
- 四个操作按钮：
  - **收藏商品** - 收藏商品名称（紫色）
  - **收藏店铺** - 收藏当前店铺（蓝色）
  - **收藏商品实例** - 收藏特定商品在特定店铺（红色）
  - **加入购物车** - 添加到购物清单（橙色）

### 在收藏管理页面
- 切换标签页查看不同类型的收藏
- 展开商品收藏查看详细信息
- 一键添加到购物车
- 删除收藏

## 技术实现

### 数据结构
```typescript
// 商品收藏
interface ProductFavorite {
  id: number;
  user_id: string;
  product_name_en: string;
  product_name_zh: string;
  product_image: string;
  product_category: string;
  created_at: string;
  last_viewed_at?: string;
}

// 店铺收藏
interface StoreFavorite {
  id: number;
  user_id: string;
  supermarket_id: number;
  created_at: string;
  supermarket?: Supermarket;
}
```

### 状态管理
- 使用 `useUser` Context 管理所有收藏状态
- 支持演示模式（Demo Mode）和真实后端
- 实时同步收藏状态

### 演示模式
- 当Supabase连接失败时自动切换到演示模式
- 使用 localStorage 存储收藏数据
- 提供完整的收藏功能体验

## 用户体验

### 视觉设计
- 不同收藏类型使用不同颜色区分
- 加载状态显示旋转动画
- 响应式设计，支持移动端

### 交互反馈
- 操作成功/失败提示
- 实时状态更新
- 防止重复操作

### 多语言支持
- 支持中英文界面
- 动态文本切换

## 未来扩展

### 计划功能
- 收藏分组和标签
- 收藏分享功能
- 价格变化通知
- 收藏数据导出

### 后端集成
- Supabase数据库表结构
- 实时同步
- 用户权限管理

## 注意事项

1. **商品收藏去重**：基于商品名称（英文）去重，不区分大小写
2. **店铺收藏去重**：基于超市ID去重
3. **数据持久化**：演示模式下使用localStorage，生产环境使用数据库
4. **性能优化**：使用useMemo缓存价格数据，避免重复计算

## 测试建议

1. 测试不同收藏类型的添加/删除
2. 验证演示模式和真实模式的切换
3. 检查移动端响应式布局
4. 测试多语言切换
5. 验证收藏数据的持久化
